---
layout: default
---
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">{{ page.title | escape }}</h1>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    
    <strong>Owner:</strong> {{ page.owner }} <br />
    <strong>Year:</strong> {{ page.year }} <br />
    <strong>License:</strong> {{ page.license }} <br />
    <strong>Categories:</strong> {{ page.categories }} <br />
    <strong>File Download:</strong> <a href={{ site.s3_bucket }}/{{ page.resourceType }}/{{ page.fileName }}>{{ page.fileName }}</a> <br/>
    
    {{ content }}
   
  </div>
  
  {% capture file_loc %}
    {{ site.s3_bucket }}/{{ page.resourceType }}/{{ page.fileName }}
  {% endcapture %}
    
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js'></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <script src='https://npmcdn.com/csv2geojson@5.0.2/csv2geojson.js'></script>

  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css' rel='stylesheet' />

  <div id='map' style='width: 100%; height: 500px;'></div>
  <script>

  mapboxgl.accessToken = '{{site.mapbox-token}}';

  var map = new mapboxgl.Map({
     container: 'map', // container id
     style: 'mapbox://styles/mapbox/streets-v9', // style sheet location
     center: [-122.288356, 37.813146], // starting position, center of W Oakland
     zoom: 12 // starting zoom
  });

  $(document).ready(function() {
      $.ajax({
          type: "GET",
          url: '{{ site.s3_bucket }}/{{ page.resourceType }}/{{ page.fileName }}',
          dataType: "text",
          success: function(csvData) {makeGeoJSON(csvData);}
       });
  });

  map.on('load', function () {
      map.addLayer({
          "id": "points",
          "type": "fill",
          "source": {
              "type": "geojson",
              "data": {{file_loc|jsonify}}
        }
     });
  });
  function makeGeoJSON(csvData) {
    csv2geojson.csv2geojson(csvData, {
        latfield: 'lat',
        lonfield: 'lon',
        delimiter: ','
    }, function(err, data) {
        map.on('load', function () {

            map.addLayer({
                'id': 'pm',
                'type': 'symbol',
                'source': {
                    'type': 'geojson',
                    'data': data
                },
                'layout': {
                    "icon-image": "marker-15"
                },
                'paint': {}
            });
        });    
    });
  }

  </script>
  
  <a class="u-url" href="{{ page.url | relative_url }}" hidden></a>
</article>
